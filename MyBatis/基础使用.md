[toc]

# 在 Spring Boot 使用 Mybatis

 在Spring Boot中使用Mybatis[^1] [^2]。

+ 添加`mybatis-spring-boot-starter` 、`mysql-connector-java`、`com.alibaba.druid`三项依赖

+ 在Spring的配置文件中，配置数据源，对Mybatis进行配置

  ```yml
  spring:
    datasource:
      url: jdbc:mysql://localhost:3306/test?serverTimezone=GMT%2B8
      username: root
      password: root
      driver-class-name: com.mysql.cj.jdbc.Driver
      type: com.alibaba.druid.pool.DruidDataSource
  mybatis:
    type-aliases-package: com.hzmciu.interview.entity
    mapper-locations: classpath:mapper/*.xml
  ```

+ 建立`entity`包，在包下添加实体类。可以使用`@Data`，简化编写。

+ 建立`mapper`包，在包下添加映射接口。接口中添加CRUD方法。

+ 在`resource`文件夹下新建`mapper`文件夹，在`mapper`文件夹中，添加Mybatis的XML映射文件

  mapper标签中的`namespace`属性对应mapper接口的位置

+ 在主类中添加`@MapperScan()`，值为mapper接口所在的位置

# mybatis-config.xml全局配置文件

mybatis-config.xml配置文件例子如下[^3]：

```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <typeAliases>
        <typeAlias alias="Student" type="com.mybatis3.domain.Student" />
    </typeAliases>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC" />
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.jdbc.Driver" />
                <property name="url" value="jdbc:mysql://localhost:3306/test" />
                <property name="username" value="root" />
                <property name="password" value="admin" />
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <mapper resource="com/mybatis3/mappers/StudentMapper.xml" />
    </mappers>
</configuration>
```

<configuration>：声明在标签里面的信息是配置信息

<typeAliases>：声明在该标签里面的信息是一个个的别名

<typealias>：声明要使用别名的对象（全路径）用java注解的话可以使用@Alias注解声明
<environments>：声明在该标签内的环境变量，default表示默认的环境变量，一个environment表示一个jdbc连接数据库，如果有很多数据库的话我们要用到不同的环境变量

<environment>：声明环境变量

<transactionManager>：声明事务管理器    它的类型（type）有：JDBC（基于jdbc的事务） 还有 MANAGED（托管的事务）

<dataSource>：声明数据源，数据源的类型有NOPOOLED ，POOLED ，还有JIDN，在数据量少的话用ONPOOLED，测试和开发过程一般用POOLED，实际运行使用JIDN

<property>：jdbc连接的一些属性

<mappers>：声明我们定义的一个个Mapper类，或者说是关联

<mapper>：声明Mapper的路径

<Settings>:声明一些全局变量的

<properties>：声明属性文件的key和value，但是如果使用了.properties文件将会被覆盖。

<typeHandlers>：自定义我们的传入参数类型处理器，需要extends BaseTypeHandler<自定义响应的类型>

**Spring Boot中如何使用mybatis-config.xml文件**：

在`application.yml`中声明 `mybatis.config-location=文件位置 `

[^1]: [Spring Boot和Mybatis的整合](https://www.cnblogs.com/peterxiao/p/7779188.html)
[^2]:[Spring Boot整合Mybatis](https://blog.csdn.net/iku5200/article/details/82856621?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-3.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-3.control)
[^3]: [详解mybatis-config配置文件](https://blog.csdn.net/YQYnsmile/article/details/52807815)